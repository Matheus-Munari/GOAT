<!DOCTYPE html>
<html lang="pt-br">

<head>
    <link rel="shortcut icon" href="../assets/icon/favicon2.ico" type="image/x-icon">
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AquaTech | Dashboards</title>

    <!-- <link rel="stylesheet" href="../css/style.css">
    <link rel="stylesheet" href="../css/dashboards.css"> -->
    <script src="../js/sessao.js"></script>
    <script src="./../js/alerta.js"></script>

    <!-- Links da minha dashboard -->
    <link rel="stylesheet" href="../css/dashboard.css">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons"
      rel="stylesheet">
      <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" />
      <!-- <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" /> -->
      <script src="https://kit.fontawesome.com/c213e24a43.js" crossorigin="anonymous"></script>
      <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
        
    <!-- sweetAlert -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/sweetalert2@11.10.1/dist/sweetalert2.min.css">
      <!-- Fim dos links -->

    <!-- <link rel="preconnect" href="https://fonts.gstatic.com">
    <link
        href="https://fonts.googleapis.com/css2?family=Exo+2:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap"
        rel="stylesheet"> -->

    <!-- scripts do Chart.js - 2022-1 -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <!--FONT AWESOME-->
    <script src="https://kit.fontawesome.com/9f7414eb10.js" crossorigin="anonymous"></script>
</head>

<body onload="mudarFoto(), obterInfosUsuarios()">
    <div class="gridContainer">

        <!-- Header -->
        <div class="header">
            <div class="header-esquerda">
                <span class="material-icons">search</span>
            </div>
            <div class="header-direira">
                <span class="material-icons">notifications</span>
                <span class="material-icons">email</span>
            </div>
        </div>

        <!-- Sidebar -->
        <div class="sidebar">
            <div class="sidebar-titulo" id="sidebar_titulo">
                <!-- <img src="../assets/imagens/messi-art.png" class="img-icone">
                <span id="b_usuario">NOME USUARIO</span> -->
            </div>

            <ul class="sidebar-list">
                <li class="sidebar-list-item">
                    <a href="./dashboard.html">
                        <i class="fa-solid fa-chart-line"></i> Dashboard
                    </a>
                </li>
                <li class="sidebar-list-item">
                    <a href="./perfil.html">
                        <i class="fa-solid fa-user"></i>Perfil
                    </a>
                </li>
                <li class="sidebar-list-item">
                    <a href="./minha-carreira.html">
                        <i class="fa-solid fa-trophy"></i>Minha Carreira
                    </a>
                </li>
                <li class="sidebar-list-item">
                    <a href="../index.html">
                        <span class="material-icons">logout</span> Sair
                    </a>
                </li>
            </ul>
        </div>

        <!-- Main -->
        <div class="main-container">
            <div class="main-conteudo">
                <div class="main-grafico">
                    <h1>Informações da conta</h1>
                    <div class="container-infos">
                        <div class="cards-infos cards-wrap">
                            <span>Nome de usuário:</span>
                            <span>
                                Email utilizado para entrar:
                            </span>
                            <span>Data de nascimento:</span>
                            <span>GOAT escolhido:</span>
                        </div>
                        <div class="cards-infos">
                            <input type="text" id="input_nome_usuario">
                            <input type="text" id="input_email_usuario">
                            <input type="date" id="input_dtNasc_usuario">
                            <input type="text" id="input_fkUsuario_usuario">
                        </div>

                    </div>
                </div>
                <div class="main-grafico" >
                    <h1 id="titulo_atributos">Atributos</h1>
                    <div class="main-atributos" id="card_atributos">
                        <div class="main-carta">
                            <div class="foto">
                                <div class="over">
                                    <div class="overall" id="overall">90</div>
                                    <div class="posicao" id="posicao">ST</div>
                                </div>
                            </div>
                            <span id="nome_usuario_carta"></span>
                            <div class="atributos">
                                <div class="esquerda">
                                    <div class="atributo">
                                        <span id="ritmo">60</span>
                                        <span>RIT</span>
                                    </div>
                                    <div class="atributo">
                                        <span id="finalizacao">60</span>
                                        <span>FIN</span>
                                    </div>
                                    <div class="atributo">
                                        <span id="passe">60</span>
                                        <span>PAS</span>
                                    </div>
                                </div>
                                <div class="direita">
                                    <div class="atributo">
                                        <span id="drible">60</span>
                                        <span>DRI</span>
                                    </div>
                                    <div class="atributo">
                                        <span id="defesa">60</span>
                                        <span>DEF</span>
                                    </div>
                                    <div class="atributo">
                                        <span id="fisico">60</span>
                                        <span>FIS</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="main-carta-atributos">
                            <div class="cabeçalho">
                                <span>Pontos Disponíveis:</span>
                                <span id="pontos_disponiveis">X</span>
                            </div>
                            <div class="pontos">        
                                <div class="esquerda">
                                    <div class="atributo">
                                        <span>RIT</span>
                                        <span id="ritmo_atualizar">60</span>
                                        <button onclick="adicionarAtributo(1, 1)">+</button>
                                        <button onclick="adicionarAtributo(1, 2)">-</button>
                                    </div>
                                    <div class="atributo">
                                        <span>FIN</span>
                                        <span id="finalizacao_atualizar">60</span>
                                        <button onclick="adicionarAtributo(2, 1)">+</button>
                                        <button onclick="adicionarAtributo(2, 2)">-</button>
                                    </div>
                                    <div class="atributo">
                                        <span>PAS</span>
                                        <span id="passe_atualizar">60</span>
                                        <button onclick="adicionarAtributo(3, 1)">+</button>
                                        <button onclick="adicionarAtributo(3, 2)">-</button>
                                    </div>
                                </div>
                                <div class="direita">
                                    <div class="atributo">
                                        <span>DRI</span>
                                        <span id="drible_atualizar">60</span>
                                        <button onclick="adicionarAtributo(4, 1)">+</button>
                                        <button onclick="adicionarAtributo(4, 2)">-</button>
                                    </div>
                                    <div class="atributo">
                                        <span>DEF</span>
                                        <span id="defesa_atualizar">60</span>
                                        <button onclick="adicionarAtributo(5, 1)">+</button>
                                        <button onclick="adicionarAtributo(5, 2)">-</button>
                                    </div>
                                    <div class="atributo">
                                        <span>FIS</span>
                                        <span id="fisico_atualizar">60</span>
                                        <button onclick="adicionarAtributo(6, 1)">+</button>
                                        <button onclick="adicionarAtributo(6, 2)">-</button>
                                    </div>
                                </div>
                            </div>
                            <button onclick="updateAtributos()">Atualizar</button>
                        </div>
                    </div>
                    <div class="cadastrar" id="cadastrar_atributos"> 
                        <p>Parece que você ainda não cadastrou suas informações, cadastre e melhore seus atributos</p>
                        <div class="formulario-atributos">
                            <span>Altura</span>
                            <input type="text" id="input_altura">
                            <span>Peso</span>
                            <input type="text" id="input_peso">
                            <span>Posição</span>    
                            <select id="select_posicao">
                                <option value="ATA">Atacante</option>
                                <option value="MEI">Meia</option>
                                <option value="ZAG">Defensor</option>
                            </select>
                            <button onclick="inserirAtributos()()">Cadastrar</button>
                        </div>
                    </div>
                </div>
            </div>

        </div>
    </div>       
        
</body>

</html>

<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11.10.1/dist/sweetalert2.all.min.js"></script>
<script>

    var infosUsuario = [];

    var jogadorFavorito = sessionStorage.FK_USUARIO;
    function mudarFoto() {

        if(jogadorFavorito == 1) {
            sidebar_titulo.innerHTML +=
            `<img src="../assets/imagens/messi-art.png" class="img-icone"> 
            <span>${sessionStorage.NOME_USUARIO}</span>`
        } else {
            sidebar_titulo.innerHTML +=
            `<img src="../assets/imagens/ronaldo-art.png" class="img-icone"> 
            <span>${sessionStorage.NOME_USUARIO}</span>`
        }

        

    }
    var idUsuario = sessionStorage.ID_USUARIO;

    function updateAtributos() {
        var ritmoAtual = ritmoU;
        var finalizacaoAtual = finalizacaoU;
        var passeAtual = passeU;
        var dribleAtual = dribleU;
        var defesaAtual = defesaU;
        var fisicoAtual = fisicoU;
        var overAtual = overU;

        fetch("/usuarios/atualizarAtributos", {
            method: "PUT",
            headers: {
                "Content-Type": "application/json",
            },
            body: JSON.stringify({
                ritmoServer: ritmoAtual,
                finalizacaoServer: finalizacaoAtual,
                passeServer: passeAtual,
                dribleServer: dribleAtual,
                defesaServer: defesaAtual,
                fisicoServer: fisicoAtual,
                idAtributos: idUsuario,
                overServer: overAtual
      }),
    }) .then(function (resposta) {
        console.log("resposta: ", resposta);

        if (resposta.ok) {
            console.log("Perfil atualizado com sucesso")


        } else {
          throw "Houve um erro ao tentar realizar o cadastro!";
        }
      })
      .catch(function (resposta) {
        console.log(`#ERRO: ${resposta}`);
        // finalizarAguardar();
      });

    }   
    
    
    function adicionarAtributo(atr, opr) {

        if(opr == 1) { 
            if(pontosRestantes <= 0) {
                console.log('Não pode');
                Swal.fire({
                            text: "Você já atribuiu todos os pontos possíveis!",
                            icon: "warning"
                            });
    
            }else{
                if(opr == 1) {
                    if(atr == 1) {
                        if(ritmoU < 99) {
                            ritmoU++;
                            atualizarAtributos();
                        }else {
                            Swal.fire({
                                text: "O maximo de pontuação possivel é 99",
                                icon: "warning"
                                });
                        }
                    } else if(atr == 2) {
                        if(finalizacaoU < 99) {
                            finalizacaoU++;
                            atualizarAtributos();
                        }else {
                            Swal.fire({
                                text: "O maximo de pontuação possivel é 99",
                                icon: "warning"
                                });
                        }
                    } else if(atr == 3) {
                        if(passeU < 99) {
                            passeU++;
                            atualizarAtributos();
                        }else {
                            Swal.fire({
                                text: "O maximo de pontuação possivel é 99",
                                icon: "warning"
                                });
                        }
                    } else if(atr == 4) {
                        if(dribleU < 99) {
                            dribleU++;
                            atualizarAtributos();
                        }else {
                            Swal.fire({
                                text: "O maximo de pontuação possivel é 99",
                                icon: "warning"
                                });
                        }
                    } else if(atr == 5) {
                        if(defesaU < 99) {
                            defesaU++;
                            atualizarAtributos();
                        }else {
                            Swal.fire({
                                text: "O maximo de pontuação possivel é 99",
                                icon: "warning"
                                });
                        }
                    } else if(atr == 6) {
                        if(fisicoU < 99) {
                            fisicoU++;
                            atualizarAtributos();
                        }else {
                            Swal.fire({
                                text: "O maximo de pontuação possivel é 99",
                                icon: "warning"
                                });
                        }
                    }
            }
        }
     
    } else {
                if(atr == 1) {
                    if(ritmoU > 1) {
                        ritmoU--;
                        atualizarAtributos();
                    }else {
                        Swal.fire({
                            text: "O mínimo de pontuação possivel é 1",
                            icon: "warning"
                            });
                    }
                } else if(atr == 2) {
                    if(finalizacaoU > 1) {
                        finalizacaoU--;
                        atualizarAtributos();
                    }else {
                        Swal.fire({
                            text: "O mínimo de pontuação possivel é 1",
                            icon: "warning"
                            });
                    }
                } else if(atr == 3) {
                    if(passeU > 1) {
                        passeU--;
                        atualizarAtributos();
                    }else {
                        Swal.fire({
                            text: "O mínimo de pontuação possivel é 1",
                            icon: "warning"
                            });
                    }
                } else if(atr == 4) {
                    if(dribleU > 1) {
                        dribleU--;
                        atualizarAtributos();
                    }else {
                        Swal.fire({
                            text: "O mínimo de pontuação possivel é 1",
                            icon: "warning"
                            });
                    }
                } else if(atr == 5) {
                    if(defesaU > 1) {
                        defesaU--;
                        atualizarAtributos();
                    }else {
                        Swal.fire({
                            text: "O mínimo de pontuação possivel é 1",
                            icon: "warning"
                            });
                    }
                } else if(atr == 6) {
                    if(fisicoU > 1) {
                        fisicoU--;
                        atualizarAtributos();
                    }else {
                        Swal.fire({
                            text: "O mínimo de pontuação possivel é 1",
                            icon: "warning"
                            });
                    }
                }
            }
        calcularPontosDisponiveis();

    }

    function validarInfos() {
        var fkAtr = infosUsuario[infosUsuario.length - 1].fkAtributos;
        
        if(fkAtr > 0) {
            card_atributos.style.display = 'flex';
            cadastrar_atributos.style.display = 'none';
        } else {
            card_atributos.style.display = 'none';
            cadastrar_atributos.style.display = 'block';
        }

        calcularPontosDisponiveis()

    }

    var atributosSoma = []
    var ritmoU = 0;
    var finalizacaoU = 0;
    var passeU = 0;
    var dribleU = 0;
    var defesaU = 0;
    var fisicoU = 0;  
    var overU = 0;
    var pontos = 0;
    var pontosRestantes = 0;


    function calcularPontosDisponiveis() {

        var somaAtributos = ritmoU + finalizacaoU + passeU + dribleU + defesaU + fisicoU;
        pontosRestantes = pontos - somaAtributos;
        
        pontos_disponiveis.innerText = pontosRestantes;

    }

    function exibirInfos() {

        input_nome_usuario.value = infosUsuario[0].nome;
        input_email_usuario.value = infosUsuario[0].email;
        input_dtNasc_usuario.value = infosUsuario[0].dtNasc.substr(0, 10);

        if(jogadorFavorito == 1) {
            input_fkUsuario_usuario.value = 'Messi';
        } else {
            input_fkUsuario_usuario.value = 'Cristiano Ronaldo';
        }
        ritmoU = infosUsuario[0].ritmo;
        finalizacaoU = infosUsuario[0].finalizacao;
        passeU = infosUsuario[0].passe;
        dribleU = infosUsuario[0].drible;
        defesaU = infosUsuario[0].defesa;
        fisicoU = infosUsuario[0].fisico;
        
        // Card
        pontos = infosUsuario[0].pontos;
        overU = parseInt(pontos/6)
        
        atualizarAtributos()

        validarInfos()
        
    }

    function atualizarAtributos() {
        nome_usuario_carta.innerText = infosUsuario[0].nome;
        overall.innerHTML = infosUsuario[0].overall;
        posicao.innerHTML = infosUsuario[0].posicao;
        ritmo.innerText = ritmoU;
        finalizacao.innerText = finalizacaoU;
        passe.innerText = passeU;
        drible.innerText = dribleU;
        defesa.innerText = defesaU;
        fisico.innerText = fisicoU;
        
        // Atualizar
        ritmo_atualizar.innerText = ritmoU;
        finalizacao_atualizar.innerText = finalizacaoU;
        passe_atualizar.innerText = passeU;
        drible_atualizar.innerText = dribleU;
        defesa_atualizar.innerText = defesaU;
        fisico_atualizar.innerText = fisicoU;


    }

    function obterInfosUsuarios() {

        var idUsuario = sessionStorage.ID_USUARIO;

        console.log(idUsuario);

    fetch(`/usuarios/buscar/:${idUsuario}`, {
        cache: 'no-store'
    }).then(function(response) {
        
            if(response.ok) {
                response.json().then(function(resposta) {
                    console.log(`Dados recebidos: ${JSON.stringify(resposta)}`);

                    infosUsuario.push(resposta[0]);
                    exibirInfos();

            });
        }else {
            console.error('Nenhum dado encontrado ou erro na API')
        }
    })
        .catch(function (error) {
            console.error(`Erro na obtenção dos dados p/ gráfico: ${error.message}`)
        })
}

    function cadastrarStats() {
        var altura = Number(input_altura.value);
        var peso = Number(input_peso.value);
        var posicao = select_posicao.value;
        var idUsuario = sessionStorage.ID_USUARIO;

        fetch("/usuarios/atualizar", {
            method: "PUT",
            headers: {
                "Content-Type": "application/json",
            },
            body: JSON.stringify({
                alturaServer: altura,
                pesoServer: peso,
                posicaoServer: posicao,
                idUsuarioServer: idUsuario
      }),
    }) .then(function (resposta) {
        console.log("resposta: ", resposta);

        if (resposta.ok) {
            console.log("Perfil atualizado com sucesso")

        } else {
          throw "Houve um erro ao tentar realizar o cadastro!";
        }
      })
      .catch(function (resposta) {
        console.log(`#ERRO: ${resposta}`);
        // finalizarAguardar();
      });
}

function inserirAtributos() {
    var idAtributo = idUsuario;

    fetch("/usuarios/inserirAtributos", {
            method: "POST",
            headers: {
                "Content-Type": "application/json",
            },
            body: JSON.stringify({
                idAtributoServer: idAtributo
      }),
    }) .then(function (resposta) {
        console.log("resposta: ", resposta);

        if (resposta.ok) {
            console.log("Perfil atualizado com sucesso")

            cadastrarStats();

        } else {
          throw "Houve um erro ao tentar realizar o cadastro!";
        }
      })
      .catch(function (resposta) {
        console.log(`#ERRO: ${resposta}`);
        // finalizarAguardar();
      });

}

</script>